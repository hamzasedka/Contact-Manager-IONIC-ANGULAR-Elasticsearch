<ng-container *ngIf="this.vm$ | async as vm">
  <dom-dialog-layout (closeClick)="this.onCloseClick()" [canClose]="!!this.dialogRef">
    <form [formGroup]="companyForm" (ngSubmit)="this.onSave(vm.company, $event)">
      <div fxLayout="column" fxLayoutGap>
        <div fxLayoutAlign="center center">
          <button mat-raised-button color="accent" type="submit" [disabled]="!companyForm.valid">
            Ajouter
          </button>
        </div>
        <!-- name -->
        <mat-form-field color="accent">
          <input matInput type="text" formControlName="name" placeholder="Name" />
          <mat-error *ngIf="vm.nameError">{{ vm.nameError }}</mat-error>
        </mat-form-field>
        <!-- creationInProgress -->
        <div color="accent">
          <mat-checkbox formControlName="creationInProgress" placeholder="Est en cours de creation">Est en cours de
            creation </mat-checkbox>
          <mat-error *ngIf="vm.creationInProgressError">{{ vm.creationInProgressError }}</mat-error>
        </div>
        <!-- siren -->
        <mat-form-field *ngIf="!vm.changes?.creationInProgress" color="accent">
          <textarea matInput formControlName="siren" placeholder="Siren"></textarea>
          <mat-error *ngIf="vm.sirenError">{{ vm.sirenError }}</mat-error>
        </mat-form-field>
        <!-- isHosting -->
        <div color="accent">
          <mat-checkbox formControlName="isHosting" placeholder="Peux appliquer un code promotion">Est un domiciliateur
          </mat-checkbox>
          <mat-error *ngIf="vm.isHostingError">{{ vm.isHosting }}</mat-error>
        </div>
        <!-- prefectoralId -->
        <mat-form-field *ngIf="vm.changes?.isHosting" color="accent">
          <textarea matInput formControlName="prefectoralId" placeholder="Agrément préfectoral"></textarea>
          <mat-error *ngIf="vm.prefectoralIdError">{{ vm.prefectoralIdError }}</mat-error>
        </mat-form-field>

        <!--  addressId -->
        <dom-addresses-input formControlName="addressId"></dom-addresses-input>

        <!--  Kbis doc downloader -->
        <dom-fire-storage-uploader [label]="'Charger les justificatifs legales (Kbis...) :'"
          formControlName="companyDocIds">
        </dom-fire-storage-uploader>
      </div>
    </form>
  </dom-dialog-layout>
</ng-container>
